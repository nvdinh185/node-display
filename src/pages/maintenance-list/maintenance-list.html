<ion-header>
    <ion-navbar>
        <ion-title>BẢO DƯỠNG SITES</ion-title>
        <!-- <ion-buttons *ngIf="!isSearch && dynamicList?.search_bar" start>
            <button ion-button icon-only color="royal" (click)="goSearch('REMOTE')">
                Thêm Kế hoạch
            </button>
        </ion-buttons>
        <ion-buttons end *ngIf="!isSearch && dynamicList?.search_bar">
            <button ion-button icon-only color="royal" (click)="goSearch('LOCAL')">
                <ion-icon name="search"></ion-icon>
            </button>
        </ion-buttons> -->

        <ion-buttons end *ngIf="dynamicList?.search_bar || dynamicList?.correct_bar">
            <button *ngIf="dynamicList?.correct_bar && !dynamicList?.correct_bar?.is_search" ion-button icon-only color="royal" (click)="goSearch('REMOTE')">
                <!-- <ion-icon name="ios-cloud-download-outline"></ion-icon> -->
                Thêm Kế hoạch
            </button>
            <button *ngIf="dynamicList?.search_bar && !dynamicList?.search_bar?.is_search" ion-button icon-only color="royal" (click)="goSearch('LOCAL')">
                <ion-icon name="search"></ion-icon>
            </button>
        </ion-buttons>
        
        <!-- <ion-buttons end *ngFor="let btn of dynamicList?.buttons">
            <button ion-button icon-only color="{{btn.color}}" (click)="onClickHeader(btn)">
                <ion-icon name="{{btn.icon}}"></ion-icon>
            </button>
        </ion-buttons> -->

        <ion-searchbar start *ngIf="dynamicList?.search_bar && dynamicList?.search_bar?.is_search" 
            placeholder="{{dynamicList.search_bar.placeholder}}" 
            [(ngModel)]="dynamicList.search_bar.search_string"
            (keyup.enter)="searchEnter('LOCAL')"
            (keyup.esc)="searchEnter('LOCAL')"
            (ionInput)="onInput($event)" 
            (focusout)="searchEnter('LOCAL')"
            (ionChange)="setFilteredItems()">
            <!-- [showCancelButton]="shouldShowCancel"
            (ionInput)="onInput($event)"
            (keyup.enter)="searchEnter('LOCAL')"
            (keyup.esc)="searchEnter('LOCAL')"
            (ionChange)="setFilteredItems()"> -->
        </ion-searchbar>
        <ion-title *ngIf="!dynamicList?.search_bar?.is_search">{{dynamicList?.title}} ({{cycle?.name}})</ion-title>
    </ion-navbar>
</ion-header>

<ion-content>
    <div *ngIf="dynamicList?.correct_bar && dynamicList?.correct_bar?.is_search" style="width: 100%; z-index: 999;position: absolute;">
        <ng-template #withSites let-attrs="attrs">
            <!-- <img src="{{attrs.data.flag}}" class="flag" /> -->
            <span [innerHTML]="attrs.data.site_id + '<br />' + attrs.data.address | boldprefix:attrs.keyword"></span>
        </ng-template>
        <!-- (focusout)="searchEnter()"
            [options]="searchOptions"
            [(ngModel)]="searchString"
            (keyup.enter)="searchEnter()"
            (keyup.esc)="searchEnter()"
            (ionBlur)="searchEnter()" -->
        <ion-auto-complete style="width: 100%"
            [template]="withSites"
            [dataProvider]="apiAutoSiteService" #searchBar
            [(ngModel)]="dynamicList.correct_bar.search_string"
            [options]="dynamicList.correct_bar.options"
            (focusout)="searchSelect($event,'OUT')"
            (keyup.enter)="searchEnter('REMOTE')"
            (keyup.esc)="searchEnter('REMOTE')"
            (itemSelected)="searchSelect($event,'SELECTED')">
        </ion-auto-complete>
    </div>
    <ion-list>
        <!-- <ion-item>
            <ion-title>test</ion-title>
        </ion-item> -->
        <ion-item-sliding #slidingItem class="background-list" *ngFor="let sheet of dynamicList?.items">

            <ion-item #item class="background-item" tappable (click)="onClickItem(cycle)">
                <!-- <ion-avatar item-start *ngIf="cycle.image">
                        <img [src]="cycle.image">
                    </ion-avatar> -->
                <ion-title>{{sheet.site_id}} ({{sheet.name}})</ion-title>
                <h3>{{sheet.address}}</h3>
                <!-- <ion-note item-end>{{site.create_time | date: 'dd/MM/yyyy'}}</ion-note> -->
                <ion-note item-end>{{ sheet.maintenance_status | strings: 'STATUS' }}</ion-note>
            </ion-item>

            <ion-item-options>
                <button ion-button color="secondary" (click)="onClickDetails(slidingItem, sheet, cycle, 'MOVE')">
                    <ion-icon name="ios-redo-outline"></ion-icon>
                    Chuyển Kế hoạch
                </button>
                <button ion-button color="primary" (click)="onClickDetails(slidingItem, sheet, cycle, 'MAINTAIN')">
                    <ion-icon name="ios-clipboard-outline"></ion-icon>
                    Phiếu Bảo dưỡng
                </button>
            </ion-item-options>

            <ion-item-options side="left">
                <button ion-button color="primary" expandable (click)="onClickDetails(slidingItem, cycle, 'RELOAD')">
                    <ion-icon name="checkmark"></ion-icon>
                    <div>Tổng hợp</div>
                    <ion-spinner id="archive-spinner"></ion-spinner>
                </button>
            </ion-item-options>

        </ion-item-sliding>

    </ion-list>
</ion-content>